<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"
        integrity="sha384-Gr6Lu2Ajx28mzwyVR8CFkULdCU7kMlZ9UthllibdOSo6qAiN+yXNHqtgdTvFXMT4"
        crossorigin="anonymous"></script>
    <script src="{{ url_for('static', filename='jquery/jquery-3.7.1.min.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static',filename='home.css') }}">
    <!-- <title>Document</title> -->
</head>

<script type="text/javascript">
    window.onload = function () {
        const socket = io();
        let socketid = undefined
        socket.connect("https://localhost:5000");
        let progressBar = document.getElementById("progressBar");

        socket.on("connect", function () {
            console.log("Connected!");
            socketid = socket.id;
            console.log("ID: " + socketid);
            $("#socketid").val(socketid);

        })
        socket.on("update progress", function (perecent) {
            //do something with percent
            console.log("Got perecent: " + perecent);
            progressBar.style.width = perecent + "%";
        })

        let btn_submit = $("#trigger");
        btn_submit.click(function () {

            $("#mainForm").submit();

            fetch("/progressInfo/" + socketid, {
                method: "POST"
            }).then(response => {
            });

        });


        // let mainForm = document.getElementById("trigger");
        // mainForm.onclick = function (event) {
        //     event.preventDefault();
        //     fetch("/progressInfo/" + socketid, {
        //         method: "POST"
        //     }).then(response => {
        //         // setTimeout(function () {
        //         //     progressBar.style.width = "0%";
        //         // }, 1000);
        //     });
        // }
    }
</script>

<body>

    <form method="POST" action="/generate" id="mainForm">

        <div class="container">

            <p><input type="hidden" name="socketid" </p>

            <textarea placeholder="Promote" name="prompt">


            </textarea>

            <p><button id="trigger" type="submit">Submit</button></p>



            <!-- <div class="progress_bar"></div> -->

            <div class="progress" style="width: 50vw; margin-top: 10px; margin-right: 1vw; background-color: grey;">
                <div class="progress-bar" id="progressBar" role="progressbar" aria-label="Basic example"
                    aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <div class="return_image"><img src="{{ user_image }}" alt="User Image"></div>

        </div>

    </form>






</body>

</html>